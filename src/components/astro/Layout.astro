---
/**
 * Layout Component
 *
 * Main layout wrapper with Minecraft-themed styling.
 * Includes header with navigation and global CSS imports.
 */

interface Props {
  /** Page title (shown in browser tab) */
  title: string;
  /** Optional description for SEO */
  description?: string;
}

const {
  title,
  description = "Optimized enchantment recipes for Minecraft crafting at scale"
} = Astro.props;

const currentPath = Astro.url.pathname;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <meta name="description" content={description} />
    <meta name="generator" content={Astro.generator} />

    <!-- Open Graph / Social -->
    <meta property="og:type" content="website" />
    <meta property="og:title" content={`${title} | MC Enchant Guide`} />
    <meta property="og:description" content={description} />
    <meta property="og:site_name" content="MC Enchant Guide" />
    <meta name="twitter:card" content="summary" />

    <!-- Theme color for mobile browsers -->
    <meta name="theme-color" content="#1a1a1a" />

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />

    <!-- Page title -->
    <title>{title} | MC Enchant Guide</title>

    <!-- Global styles -->
    <style is:global>
      @import "../../styles/minecraft.css";
      @import "../../styles/components.css";
      @import "../../styles/tree.css";
      @import "../../styles/modal.css";
    </style>
  </head>

  <body>
    <div class="site-wrapper">
      <!-- Header -->
      <header class="site-header">
        <div class="container header-content">
          <!-- Logo/Title -->
          <a href="/" class="site-title">
            <span class="site-title-icon" aria-hidden="true">⚒️</span>
            <span class="site-title-text">MC Enchant Guide</span>
          </a>

          <!-- Navigation -->
          <nav class="site-nav" aria-label="Main navigation">
            <a
              href="/"
              class:list={["nav-link", { active: currentPath === "/" }]}
            >
              Catalog
            </a>
            <a
              href="/list"
              class:list={["nav-link nav-link-cart", { active: currentPath === "/list" }]}
            >
              <span class="nav-link-text">Shopping List</span>
              <!-- Cart count badge - will be populated by Solid.js -->
              <span class="cart-badge" id="cart-badge" style="display: none;">0</span>
            </a>
          </nav>
        </div>
      </header>

      <!-- Main content -->
      <main class="site-main">
        <div class="container">
          <slot />
        </div>
      </main>

      <!-- Footer -->
      <footer class="site-footer">
        <div class="container footer-content">
          <p class="footer-text">
            Minecraft data verified against
            <a href="https://minecraft.wiki" target="_blank" rel="noopener noreferrer">
              minecraft.wiki
            </a>
          </p>
          <p class="footer-version">v0.1.0</p>
        </div>
      </footer>
    </div>

    <!-- Script to hydrate cart badge from localStorage -->
    <script>
      function updateCartBadge(): void {
        const badge = document.getElementById('cart-badge');
        if (!badge) return;

        try {
          const stored = localStorage.getItem('mc-enchant:cart');
          if (stored) {
            const cart = JSON.parse(stored);
            const items = cart.items || [];
            const totalItems = items.reduce(
              (sum: number, item: { quantity: number }) => sum + (item.quantity || 0),
              0
            );

            if (totalItems > 0) {
              badge.textContent = totalItems > 99 ? '99+' : String(totalItems);
              badge.style.display = 'inline-flex';
            } else {
              badge.style.display = 'none';
            }
          }
        } catch {
          // Ignore localStorage errors
        }
      }

      // Update on page load
      updateCartBadge();

      // Listen for storage changes (from other tabs)
      window.addEventListener('storage', (e) => {
        if (e.key === 'mc-enchant:cart') {
          updateCartBadge();
        }
      });

      // Custom event for same-tab updates
      window.addEventListener('cart-updated', updateCartBadge);
    </script>

    <style>
      /* ─────────────────────────────────────────────────────────────
       * Layout Structure
       * ───────────────────────────────────────────────────────────── */

      .site-wrapper {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
      }

      .site-main {
        flex: 1;
        padding-block: var(--space-lg);
      }

      /* ─────────────────────────────────────────────────────────────
       * Header
       * ───────────────────────────────────────────────────────────── */

      .site-header {
        position: sticky;
        top: 0;
        z-index: var(--z-sticky);
        background-color: var(--mc-dark-gray);
        border-bottom: 2px solid var(--mc-black);
        box-shadow: var(--shadow-md);
      }

      .header-content {
        display: flex;
        align-items: center;
        justify-content: space-between;
        height: var(--header-height);
        gap: var(--space-md);
      }

      .site-title {
        display: flex;
        align-items: center;
        gap: var(--space-sm);
        text-decoration: none;
        color: var(--mc-white);

        &:hover {
          text-decoration: none;
        }
      }

      .site-title-icon {
        font-size: var(--text-xl);
      }

      .site-title-text {
        font-family: var(--font-display);
        font-size: var(--text-lg);
        text-shadow: 2px 2px 0 var(--mc-black);
      }

      /* ─────────────────────────────────────────────────────────────
       * Navigation
       * ───────────────────────────────────────────────────────────── */

      .site-nav {
        display: flex;
        align-items: center;
        gap: var(--space-xs);
      }

      .nav-link {
        display: inline-flex;
        align-items: center;
        gap: var(--space-xs);
        padding: var(--space-sm) var(--space-md);
        font-size: var(--text-sm);
        color: var(--mc-light-gray);
        text-decoration: none;
        border-radius: 2px;
        transition: background-color var(--transition-fast), color var(--transition-fast);

        &:hover {
          background-color: var(--mc-gray);
          color: var(--mc-white);
          text-decoration: none;
        }

        &.active {
          background-color: var(--mc-gray);
          color: var(--mc-gold);
        }

        &:focus-visible {
          outline: 2px solid var(--mc-gold);
          outline-offset: 2px;
        }
      }

      .nav-link-cart {
        position: relative;
      }

      .cart-badge {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        min-width: 18px;
        height: 18px;
        padding: 0 4px;
        font-size: 11px;
        font-weight: bold;
        line-height: 1;
        color: var(--mc-white);
        background-color: var(--mc-red);
        border-radius: 9px;
      }

      /* ─────────────────────────────────────────────────────────────
       * Footer
       * ───────────────────────────────────────────────────────────── */

      .site-footer {
        background-color: var(--mc-dark-gray);
        border-top: 2px solid var(--mc-black);
        padding-block: var(--space-md);
      }

      .footer-content {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: var(--space-md);
      }

      .footer-text {
        font-size: var(--text-sm);
        color: var(--mc-gray);
        margin: 0;

        & a {
          color: var(--mc-aqua);
        }
      }

      .footer-version {
        font-size: var(--text-xs);
        font-family: var(--font-mono);
        color: var(--mc-gray);
        margin: 0;
      }

      /* ─────────────────────────────────────────────────────────────
       * Responsive Adjustments
       * ───────────────────────────────────────────────────────────── */

      @media (max-width: 640px) {
        .site-title-text {
          font-size: var(--text-base);
        }

        .nav-link {
          padding: var(--space-xs) var(--space-sm);
        }

        .footer-content {
          flex-direction: column;
          gap: var(--space-xs);
          text-align: center;
        }
      }
    </style>
  </body>
</html>
