# Task 014: Craft Progress Store

## Status
DONE

## Description
Implement the craft progress store for tracking step completion within crafting trees. Users can check off completed anvil operations and material gathering. State is persisted to localStorage per recipe.

## Dependencies
- Task 003 (Core types - CraftProgress interface)
- Task 013 (Cart store - similar pattern)

## Acceptance Criteria
- [x] `src/stores/craft-progress.ts` created
- [x] Progress store with Solid.js signals:
  - `getProgress(recipeId)` - get completed node IDs for recipe
  - `toggleNode(recipeId, nodeId)` - toggle completion state
  - `isCompleted(recipeId, nodeId)` - check if node is completed
  - `reset(recipeId)` - clear progress for recipe
  - `resetAll()` - clear all progress
- [x] Derived state:
  - `getCompletionPercent(recipeId, totalNodes)` - completion percentage
  - `isRecipeComplete(recipeId, totalNodes)` - all nodes done
- [x] localStorage persistence:
  - Key: `mc-enchant:progress`
  - Auto-save on changes
  - Auto-load on initialization
  - Handle corrupted data gracefully
- [x] Unit tests with 80%+ coverage (achieved 100%)
- [x] Works in SSR context

## Files to Create/Modify
- `src/stores/craft-progress.ts`
- `tests/unit/stores/craft-progress.test.ts`

## Reference
- `specification.md`: State Management section, CraftProgress interface
- Task 013 for store pattern reference

## Store Interface
```typescript
// Types (from src/types/index.ts)
interface CraftProgress {
  recipeId: string;
  completedNodeIds: string[];
}

// Store API
const progressStore = {
  // State access
  getProgress(recipeId: string): string[],  // Returns completed node IDs

  // Actions
  toggleNode(recipeId: string, nodeId: string): void,
  reset(recipeId: string): void,
  resetAll(): void,

  // Derived
  isCompleted(recipeId: string, nodeId: string): boolean,
  getCompletionPercent(recipeId: string, totalNodes: number): number,
  isRecipeComplete(recipeId: string, totalNodes: number): boolean,
};
```

## localStorage Format
```json
{
  "swords/god-sword": ["node_1", "node_3", "node_5"],
  "pickaxes/fortune-pick": ["node_1"]
}
```

## Test Cases
- Toggle node on (add to completed)
- Toggle node off (remove from completed)
- Get progress for unknown recipe (empty array)
- isCompleted returns correct state
- Reset clears recipe progress
- Reset does not affect other recipes
- ResetAll clears all progress
- Completion percent calculated correctly
- isRecipeComplete works at 100%
- Persistence: save to localStorage
- Persistence: load from localStorage
- Persistence: handle invalid data
- SSR safety

## UI Integration Notes
The progress store powers two UI features:

1. **Craft Order Tab** - Checkboxes for each combine step
   - Node IDs correspond to `CraftingTreeNode.id`
   - Visual feedback (strikethrough, dimmed) for completed steps

2. **Pick List Tab** - Checkboxes for materials
   - Leaf node IDs for books and base item
   - Track material gathering separately from crafting

## Notes
- Use Map structure internally for O(1) recipe lookup
- Progress survives page refresh (localStorage)
- Consider clearing progress when recipe is removed from cart
- Node IDs are generated by optimizer, ensure consistency
- Export reactive accessors for UI binding
